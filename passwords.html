<!-- Interfaz para validar que el usuario ingrese un correo electronico para proceder
    con el cambio de contraseñas de su correo electrónico   -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empreverest</title>

    <!-- Referencias para archivos locales-->
    <link rel="stylesheet" href="styles/style_password.css">
    <link rel="stylesheet" href="src-ico/empreverest.svg">

    <!-- Referencia para Bootstrap-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.bundle.min.js"></script>

    <!-- Referencia para BoxIcons-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Referencia para AwesomeFont-->
    <link href="/your-path-to-fontawesome/css/fontawesome.css" rel="stylesheet">
    <link href="/your-path-to-fontawesome/css/brands.css" rel="stylesheet">
    <link href="/your-path-to-fontawesome/css/solid.css" rel="stylesheet">

    <!-- Favicon-->
    <link rel="icon" href="src-ico/empreverest.svg" type="image/x-icon">

    <!-- Referencia para la API de Google-->
    <script src="https://www.google.com/recaptcha/api.js?render=6LeriJspAAAAAD_UGlSansdlmb6cKYvYWku9dRuG"></script>
</head>

<body>

    <!-- Icono para regresar a la pagina principal-->
    <div class="contenedor">
        <a href="index.html" class="etiqueta">
            <button class="botonAtras" type="button">
                <img src="src-ico/empreverest.svg" alt="Empreverest">
            </button>
        </a>
    </div>

    <div class="fullbox">

        <form id="form-passwords" action="val_passwords.php" method="post">

            <!-- Titulo principal-->
            <h1>Nueva contraseña</h1>

            <div class="texto">
                <p>Ingrese su nueva contraseña en los campos de texto</p>
            </div>

            <!-- Caja para ingresar la contraseña-->
            <div class="input-box">
                <label for="inputPassword5" class="form-label">Nueva contraseña</label>
                <input type="password" id="cambiarContraseña" class="form-control" name="cambiarContraseña"
                    aria-describedby="passwordHelpBlock" placeholder="Contraseña" required>
                <div id="passwordHelpBlock" class="form-text"></div>
            </div>

            <!-- Caja para ingresar la contraseña-->
            <div class="input-box">
                <label for="inputPassword5" class="form-label">Confirmar contraseña</label>
                <input type="password" id="confirmarContraseña" class="form-control" name="confirmarContraseña"
                    aria-describedby="passwordHelpBlock" placeholder="Contraseña" required>
                <div id="passwordHelpBlock" class="form-text"></div>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="mostrarContraseñas">
                <label class="form-check-label" for="mostrarContraseñas" style="font-size: 13px;">Mostrar contraseñas</label>
            </div>

            <br>

            <!--Boton para cambiar contraseña-->
            <button type="submit" id="entrar" class="botonEnviarCodigo" style="margin-top: 15px;">Cambiar contraseña</button>
            <!--<button type="button" class="botonEnviarCodigo" style="margin-top: 15px;" onclick="mostrarModalConfirmacion()">Cambiar contraseña</button> -->

            <!--Volver al login en caso de que el usuario lo desee-->
            <div class="login">
                <p>¿Recordaste tu contraseña? <a href="login.html">Inicia sesión</a> </p>
            </div>

        </form>
    </div>

    <!--Icono y título parte derecha-->
    <div class="contenedorCentrado" style="text-align: center;">
        <div style="display: inline-block;"> <!-- Div para centrar contenido -->
            <img src="src-ico/empreverest.svg" style="width: 300px; margin-bottom: -30px;" alt="Empreverest">
            <span style="display: block;">EMPREVEREST</span>
        </div>
    </div>

</body>

</html>

<!-- Toast | Mensajes para el usuario-->
<div role="alert" id="passwordToast" aria-live="assertive" aria-atomic="true" class="toast" data-bs-autohide="true">
    <div class="toast-header">
        <img src="src-ico/empreverest.svg" class="rounded me-2" alt="Empreverest">
        <strong class="me-auto">Error de contraseña</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
        Mensaje al usuario
    </div>
</div>

<script>
    // Obtener los parámetros de la URL
    const urlParams = new URLSearchParams(window.location.search); //Buscar la URL actual 
    const loginStatus = urlParams.get('login');
    const errorType = urlParams.get('error');
  
    // Función para mostrar el toast de error
    function showToast() {
        const toastEl = document.getElementById('passwordToast');
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
    }
  
    // Mostrar el toast correspondiente según el parámetro de cambio de contraseña  
    if (loginStatus === 'fail' && errorType === 'wrong_passwords') {
      document.querySelector('.toast-body').innerText = 'Las contraseñas ingresadas no son iguales';
      showToast(); //Mostrat el toast
    }
    else if(loginStatus === 'fail' && errorType === 'repeated_passwords') { //Validar si la contraseña ingresada no es igual a la contraseña existente en la base de datos 
      document.querySelector('.toast-body').innerText = 'La nueva contraseña no puede ser igual a la actual';
      showToast(); //Mostrat el toast
    }
    else if(loginStatus === 'fail' && errorType === 'bad_passwords') { //Validar si la contraseña ingresada contiene caracteres inválidos
      document.querySelector('.toast-body').innerText = 'La contraseña ingresada contiene caractéres no válidos. Por favor intente de nuevo';
      showToast(); //Mostrat el toast
    }
    else if(loginStatus === 'fail' && errorType === 'bad_cantidadCharsMin') { //Validar si la contraseña tiene por lo menos 8 caracteres 
      document.querySelector('.toast-body').innerText = 'La contraseña ingresada no contiene mínimo de 8 caracteres. Intente de nuevo';
      showToast(); //Mostrat el toast
    }
    else if(loginStatus === 'fail' && errorType === 'bad_cantidadCharsMax') { //Validar si la contraseña excede de un numero de caracteres maximo 
      document.querySelector('.toast-body').innerText = 'La contraseña ingresada excede el límite de caracteres necesarios. Intente de nuevo';
      showToast(); //Mostrat el toast
    }
  </script>

<!-- Mostrar contraseñas cuando se presion el checkbox-->
<script>
    const mostrarContraseñasCheckbox = document.getElementById('mostrarContraseñas');
    const cambiarContraseñaInput = document.getElementById('cambiarContraseña');
    const confirmarContraseñaInput = document.getElementById('confirmarContraseña');

    mostrarContraseñasCheckbox.addEventListener('change', function() {
        if (this.checked) {
            cambiarContraseñaInput.type = 'text';
            confirmarContraseñaInput.type = 'text';
        } else {
            cambiarContraseñaInput.type = 'password';
            confirmarContraseñaInput.type = 'password';
        }
    });
</script>


  <!--Logica para utiliza el modal de confirmar contraseña
  <script>
    function showModal() {
    const modalEl = document.getElementById('modalConfirmar');
    const modal = new bootstrap.Modal(modalEl);
    modal.show();
  } 

  const URLactual = new URLSearchParams(window.location.search); //Buscar la URL actual 
  document.querySelector('.modal-body').innerText = '¿Está seguro de cambiar su contraseña,?';
  showModal();
  </script>
  -->
