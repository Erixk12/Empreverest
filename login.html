<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empreverest</title>

    <!-- Referenciar para Bootstrap-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.bundle.min.js"></script>
    <link rel = "stylesheet" href="styles/style.css">

    <!-- Referenciar para BoxIcons-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>


    <!-- Referenciar para AwesomeFont-->
    <link href="/your-path-to-fontawesome/css/fontawesome.css" rel="stylesheet">
    <link href="/your-path-to-fontawesome/css/brands.css" rel="stylesheet">
    <link href="/your-path-to-fontawesome/css/solid.css" rel="stylesheet">

    <!--Paleta de colores 
    Texto dentro de los botones - 
    botones - 4EABE0 26% opacidad 
    Letra de botones - 818798
    botones de confirmacion - 0B6380
    Fondo - 

    Tipo de Letra
    Letra para titulos - Poppins Bold 60
    letra para textos - Poppins regular 30
    -->
  
    <script src="https://www.google.com/recaptcha/api.js?render=6LeriJspAAAAAD_UGlSansdlmb6cKYvYWku9dRuG"></script>

  </head>
<body>

  <div class="fullbox">
    <a href="index.html">
      <button class="botonAtras"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAARVJREFUWEft1tENgjAQANBrJ3EU3YLUfuAk6iSSWBvG0E3YBMVogqVwvaYcmJTflvb1Du4qYGWPWJkHMgjLSI7QrBHSWm+NMXdsE8p4dMr2Sl0EQPna7GSsPVM2nZobBeph3msLgMPV2ioFigxyMS1AdbP2kALzOVz4UnNjSCAOTDCICxME4sSgIG7MJGgJzCjIg2kEQJI68/NPS/lwK/2gDrmY8KIQNXNQ5QcgrdSxawdRy9NfwkHdmi6qBVguZd9DeiKVtImOBXOyly2BQpsrNwoF+b6p1HegfvqCQJyoYBAXigTiQJFBXpSUu1SX/ShQH5XyPo1eP7BOUBbFpqrrBptHGY+OEGUTytwMwqKVI/R3EXoC7pWDJagfFZwAAAAASUVORK5CYII="/></button>
    </a>

    <form id="form-login" action="validarlogin.php" method="post">

      <h1>Iniciar Sesión</h1>
      
      <!-- Caja para ingresar el correo electronico-->
      <div class="input-box">
        <label for="exampleFormControlInput1" class="form-label">Correo electrónico</label>
        <input type="email" class="form-control" id="exampleFormControlInput1" name="correoelectronico" placeholder="Correo electrónico" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\.udg\.mx$" required>        
        <i class='bx bx-user'></i>
      </div>

      <!-- Caja para ingresar la contraseña-->
      <div class="input-box">
        <label for="inputPassword5" class="form-label">Contraseña</label>
        <input type="password" id="inputPassword5" class="form-control" name="contraseña" aria-describedby="passwordHelpBlock" placeholder="Contraseña" required> 
        <div id="passwordHelpBlock" class="form-text"></div>
        <i id="togglePassword" class='bx bx-lock-alt'></i> 
      </div>

      <script>
        // Función para alternar entre contraseña visible y oculta
        document.getElementById('togglePassword').addEventListener('click', function() {
          var passwordInput = document.getElementById('inputPassword5');
          var toggleIcon = document.getElementById('togglePassword');

          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('bx-lock-alt');
            toggleIcon.classList.add('bx-lock-open-alt');
          } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('bx-lock-open-alt');
            toggleIcon.classList.add('bx-lock-alt');
          }
        });
      </script>

      <!-- Link en caso de que el usuario halla olvidado la contraseña-->
      <div class="olvidarContraseña">
        <label>
          <a id="olvidarContraseña">¿Olvidaste tu contraseña?</a>
        </label>
      </div>

      <!--Boton para iniciar sesion-->
      <button type="submit" id="entrar" class="botonIniciarSesion">Iniciar Sesión</button>

      <!--link para registrarse-->
      <div class="registrarse">
        <p>¿No tienes una cuenta? <a href="Registrarse.html">Regístrate</a> </p>
      </div>

      <!--Boton para iniciar sesion con Google-->
      <button class="botonGoogle" button type="button"> <img src="src-ico/google.png"></box-icon></button>

    </form>
  </div>

  <form id="form-cambiarcontraseña" action="recon.php" method="post">
  <!-- Modal de cambiar contraseña -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog d-flex align-items-center justify-content-center">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Recuperación de contraseña</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="POST" action="recon.php" id="formul">
            <div class="mb-3">
              <label for="email" class="form-label">Ingrese su Correo electrónico</label>
              <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Enviar código</button>
        </div>
      </div>
    </div>
  </div>
  </form>

</body>
</html>

<div class="toast fixed-top position-absolute bg-danger" style="position: absolute; top: 15px; left: 50%; transform: translateX(-50%);" id="loginToast" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body text-white">  
      Hello, world! This is a toast message.
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>

<script>
  // Obtener los parámetros de la URL
  const urlParams = new URLSearchParams(window.location.search); //Buscar la URL actual 
  const loginStatus = urlParams.get('login');
  const errorType = urlParams.get('error');

  // Mostrar el toast correspondiente según el parámetro de error
  if (loginStatus === 'fail') {
      if (errorType === 'incorrect_password') {
          // Contraseña incorrecta
          document.querySelector('.toast-body').innerText = 'Contraseña o usuario incorrecto'; // Seleccionamos por clase
          showToast();
      } else if (errorType === 'not_registered') {
          // Usuario no registrado
          document.querySelector('.toast-body').innerText = 'El usuario no está registrado'; // Seleccionamos por clase
          showToast();
      } else if (errorType === 'invalid_email') {
          // Correo electrónico inválido
          document.querySelector('.toast-body').innerText = 'El correo electrónico no es válido'; // Seleccionamos por clase
          showToast();
      }
  }
  
  // Función para mostrar el toast
  function showToast() {
      const toastEl = document.getElementById('loginToast');
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
  }
</script>


<script>
  // Funcion para mosrtar el toasts en el cambio de contraseña
  // Obtener los parámetros de la URL
  const URL = new URLSearchParams(window.location.search); //Buscar la URL actual 
  const Login = urlParams.get('login');
  const Error = urlParams.get('error');

  // Mostrar el toast correspondiente según el parámetro de error
  if (Login === 'fail') {
      if (errorType === 'empty_email') {
          // Contraseña incorrecta
          document.querySelector('.toast-body').innerText = 'Correo electrónico inexistente'; // Seleccionamos por clase
          showToast();
      } 
  }
  
  // Función para mostrar el toast
  function showToast() {
      const toastEl = document.getElementById('loginToast');
      const toast = new bootstrap.Toast(toastEl);
      toast.show();
  }
</script>

<script>
  $(document).ready(function() {
    $('#entrar').click(function(){
      grecaptcha.ready(function() {
        grecaptcha.execute('6LeriJspAAAAAD_UGlSansdlmb6cKYvYWku9dRuG', {action: 'validarUsuario'}).then(function(token) {
          $('#form-login').prepend('<input type="hidden" name="token" value="' + token + '">');
          $('#form-login').prepend('<input type="hidden" name="action" value="validarUsuario">');
          $('#form-login').submit();
        });
      });
    });

  });
</script>

<script>
  // Capturamos el enlace "¿Olvidaste tu contraseña?" por su ID
  const olvidarContraseñaLink = document.getElementById('olvidarContraseña');

  // Capturamos el modal por su ID
  const modal = document.getElementById('exampleModal');

  // Añadimos un evento de clic al enlace
  olvidarContraseñaLink.addEventListener('click', function(event) {
    // Prevenimos el comportamiento predeterminado del enlace
    event.preventDefault();
    // Mostramos el modal utilizando Bootstrap Modal
    var myModal = new bootstrap.Modal(modal);
    myModal.show();
  });
</script>

<script>
  // Función para obtener los parámetros de la URL
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return 'hola mundo';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  // Obtener el valor y el código de la URL
  var valor = getParameterByName('valor');
  var cod = getParameterByName('cod');

  // Verificar si el código está presente y mostrarlo
  //if (cod) {
  //  document.write(cod);
  //}
</script>

